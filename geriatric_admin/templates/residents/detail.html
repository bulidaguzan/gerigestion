{% extends "base.html" %}
{% load static %}

{% block title %}{{ resident.full_name }}{% endblock %}
{% block page_title %}{{ resident.full_name }}{% endblock %}
{% block page_subtitle %}Perfil completo del residente{% endblock %}

{% block header_actions %}
<div class="flex items-center space-x-3">
    <a href="{% url 'residents_web:resident_update' resident.id %}" class="btn-modern">
        <span class="material-icons mr-2 text-base">edit</span>
        <span class="text-sm">Editar</span>
    </a>
    <a href="{% url 'residents_web:resident_list' %}" class="btn-modern-secondary">
        <span class="material-icons mr-2 text-base">arrow_back</span>
        <span class="text-sm">Volver</span>
    </a>
</div>
{% endblock %}

{% block content %}
<!-- Header principal -->
<div class="content-card mb-8">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
        <div class="flex items-center mb-6 lg:mb-0">
            <div class="flex-shrink-0 h-20 w-20 lg:h-24 lg:w-24">
                <div class="h-20 w-20 lg:h-24 lg:w-24 rounded-full bg-slate-100 flex items-center justify-center border-2 border-slate-200">
                    <span class="material-icons text-slate-600 text-3xl lg:text-4xl">elderly</span>
                </div>
            </div>
            <div class="ml-6">
                <h2 class="text-2xl lg:text-3xl font-bold text-slate-800 mb-2">{{ resident.full_name }}</h2>
                <div class="flex items-center space-x-4">
                    <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-slate-100 text-slate-700 border border-slate-200">
                        {% if resident.gender == 'M' %}👨 Masculino{% elif resident.gender == 'F' %}👩 Femenino{% else %}👤 Otro{% endif %}
                    </span>
                    <span class="text-slate-600 text-lg font-medium">{{ resident.age }} años</span>
                    {% if resident.room %}
                    <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-emerald-100 text-emerald-700 border border-emerald-200">
                        🏠 Habitación {{ resident.room.room_number }}
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
            {% if resident.phone %}
            <a href="tel:{{ resident.phone }}" class="btn-modern-success">
                <span class="material-icons mr-2">phone</span>
                Llamar
            </a>
            {% endif %}
            {% if resident.email %}
            <a href="mailto:{{ resident.email }}" class="btn-modern">
                <span class="material-icons mr-2">email</span>
                Email
            </a>
            {% endif %}
        </div>
    </div>
</div>

<!-- Acciones Rápidas -->
{% if quick_actions %}
{% include 'components/quick_actions.html' with quick_actions=quick_actions %}
{% endif %}

<!-- Métricas rápidas -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    <div class="stat-card">
        <div>
            <p class="text-xs font-medium text-slate-500">Tiempo de Estancia</p>
            <p class="text-2xl font-bold text-slate-800">{{ resident.length_of_stay }} días</p>
        </div>
        <span class="material-icons text-slate-400 text-3xl">schedule</span>
    </div>
    
    <div class="stat-card">
        <div>
            <p class="text-xs font-medium text-slate-500">Estado</p>
            <p class="text-2xl font-bold text-slate-800">Activo</p>
        </div>
        <span class="material-icons text-emerald-500 text-3xl">check_circle</span>
    </div>
    
    <div class="stat-card">
        <div>
            <p class="text-xs font-medium text-slate-500">Tratamiento</p>
            <p class="text-2xl font-bold text-slate-800">{% if resident.is_in_treatment %}Sí{% else %}No{% endif %}</p>
        </div>
        <span class="material-icons text-amber-500 text-3xl">healing</span>
    </div>
    
    <div class="stat-card">
        <div>
            <p class="text-xs font-medium text-slate-500">Informes</p>
            <p class="text-2xl font-bold text-slate-800">{{ recent_reports.count }}</p>
        </div>
        <span class="material-icons text-indigo-500 text-3xl">assessment</span>
    </div>
</div>

<!-- Grid de información principal -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Información Personal -->
    <div class="content-card">
        <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
            <span class="material-icons mr-2">person</span>
            Información Personal
        </h3>
        <div class="space-y-4">
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Nombre completo:</span>
                <span class="text-sm font-semibold text-slate-800">{{ resident.full_name }}</span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Fecha de nacimiento:</span>
                <span class="text-sm font-semibold text-slate-800">{{ resident.date_of_birth|date:"d/m/Y" }}</span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Edad:</span>
                <span class="text-sm font-semibold text-slate-800">{{ resident.age }} años</span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Género:</span>
                <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full {% if resident.gender == 'M' %}bg-blue-100 text-blue-800{% elif resident.gender == 'F' %}bg-pink-100 text-pink-800{% else %}bg-slate-100 text-slate-800{% endif %}">
                    {% if resident.gender == 'M' %}👨 Masculino{% elif resident.gender == 'F' %}👩 Femenino{% else %}👤 Otro{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Estado civil:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.marital_status %}{{ resident.get_marital_status_display }}{% else %}<span class="text-slate-400">No especificado</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Ocupación:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.occupation %}{{ resident.occupation }}{% else %}<span class="text-slate-400">No especificada</span>{% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Información de Contacto -->
    <div class="content-card">
        <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
            <span class="material-icons mr-2">contact_phone</span>
            Información de Contacto
        </h3>
        <div class="space-y-4">
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Teléfono:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.phone %}{{ resident.phone }}{% else %}<span class="text-slate-400">No especificado</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Email:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.email %}{{ resident.email }}{% else %}<span class="text-slate-400">No especificado</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-start p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Dirección:</span>
                <span class="text-sm font-semibold text-slate-800 text-right max-w-xs">
                    {% if resident.address %}{{ resident.address }}{% else %}<span class="text-slate-400">No especificada</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Ciudad:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.city %}{{ resident.city }}{% else %}<span class="text-slate-400">No especificada</span>{% endif %}
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Segunda fila de información -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
    <!-- Información Médica -->
    <div class="content-card">
        <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
            <span class="material-icons mr-2">medical_services</span>
            Información Médica
        </h3>
        <div class="space-y-4">
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Tipo de sangre:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.blood_type %}<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">{{ resident.blood_type }}</span>{% else %}<span class="text-slate-400">No especificado</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-start p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Alergias:</span>
                <span class="text-sm font-semibold text-slate-800 text-right max-w-xs">
                    {% if resident.allergies %}{{ resident.allergies|linebreaks }}{% else %}<span class="text-slate-400">Ninguna conocida</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-start p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Condiciones médicas:</span>
                <span class="text-sm font-semibold text-slate-800 text-right max-w-xs">
                    {% if resident.medical_conditions %}{{ resident.medical_conditions|linebreaks }}{% else %}<span class="text-slate-400">No especificadas</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-start p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Medicamentos:</span>
                <span class="text-sm font-semibold text-slate-800 text-right max-w-xs">
                    {% if resident.medications %}{{ resident.medications|linebreaks }}{% else %}<span class="text-slate-400">No especificados</span>{% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Estado de Tratamiento -->
    <div class="content-card">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-slate-700 flex items-center">
                <span class="material-icons mr-2">healing</span>
                Estado de Tratamiento
            </h3>
            <a href="{% url 'residents_web:resident_update' resident.id %}" 
               class="btn-modern-secondary text-xs">
                <span class="material-icons text-sm mr-1">edit</span>
                <span class="text-xs">Editar</span>
            </a>
        </div>
        <div class="space-y-4">
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">En tratamiento:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.is_in_treatment %}
                        <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full bg-emerald-100 text-emerald-800">
                            <span class="material-icons text-xs mr-1">check_circle</span>
                            Sí
                        </span>
                    {% else %}
                        <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-800">
                            <span class="material-icons text-xs mr-1">cancel</span>
                            No
                        </span>
                    {% endif %}
                </span>
            </div>
            
            {% if resident.is_in_treatment %}
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-600">Tipo de tratamiento:</span>
                    <span class="text-sm font-semibold text-slate-800">
                        {% if resident.treatment_type %}{{ resident.get_treatment_type_display }}{% else %}<span class="text-slate-400">No especificado</span>{% endif %}
                    </span>
                </div>
                
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-600">Estado del tratamiento:</span>
                    <span class="text-sm font-semibold text-slate-800">
                        {% if resident.treatment_status %}
                            <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full 
                                {% if resident.treatment_status == 'active' %}bg-green-100 text-green-800
                                {% elif resident.treatment_status == 'completed' %}bg-blue-100 text-blue-800
                                {% elif resident.treatment_status == 'suspended' %}bg-yellow-100 text-yellow-800
                                {% elif resident.treatment_status == 'discontinued' %}bg-red-100 text-red-800
                                {% elif resident.treatment_status == 'maintenance' %}bg-purple-100 text-purple-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ resident.get_treatment_status_display }}
                            </span>
                        {% else %}<span class="text-slate-400">No especificado</span>{% endif %}
                    </span>
                </div>
                
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-600">Fecha de inicio:</span>
                    <span class="text-sm font-semibold text-slate-800">
                        {% if resident.treatment_start_date %}{{ resident.treatment_start_date|date:"d/m/Y" }}{% else %}<span class="text-slate-400">No especificada</span>{% endif %}
                    </span>
                </div>
                
                {% if resident.treatment_end_date %}
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-600">Fecha de finalización:</span>
                    <span class="text-sm font-semibold text-slate-800">
                        {{ resident.treatment_end_date|date:"d/m/Y" }}
                    </span>
                </div>
                {% endif %}
                
                {% if resident.treatment_frequency %}
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-600">Frecuencia:</span>
                    <span class="text-sm font-semibold text-slate-800">
                        {{ resident.treatment_frequency }}
                    </span>
                </div>
                {% endif %}
                
                {% if resident.treatment_provider %}
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-600">Proveedor:</span>
                    <span class="text-sm font-semibold text-slate-800">
                        {{ resident.treatment_provider }}
                    </span>
                </div>
                {% endif %}
                
                {% if resident.treatment_goals %}
                <div class="flex justify-between items-start p-3 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-600">Objetivos:</span>
                    <span class="text-sm font-semibold text-slate-800 text-right max-w-xs">
                        {{ resident.treatment_goals|linebreaks }}
                    </span>
                </div>
                {% endif %}
                
                {% if resident.treatment_progress %}
                <div class="flex justify-between items-start p-3 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-600">Progreso:</span>
                    <span class="text-sm font-semibold text-slate-800 text-right max-w-xs">
                        {{ resident.treatment_progress|linebreaks }}
                    </span>
                </div>
                {% endif %}
                
                {% if resident.treatment_notes %}
                <div class="flex justify-between items-start p-3 bg-slate-50 rounded-lg">
                    <span class="text-sm font-medium text-slate-600">Notas adicionales:</span>
                    <span class="text-sm font-semibold text-slate-800 text-right max-w-xs">
                        {{ resident.treatment_notes|linebreaks }}
                    </span>
                </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>

<!-- Tercera fila de información -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
    <!-- Información de Emergencia -->
    <div class="content-card">
        <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
            <span class="material-icons mr-2">emergency</span>
            Contacto de Emergencia
        </h3>
        <div class="space-y-4">
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Nombre:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.emergency_contact_name %}{{ resident.emergency_contact_name }}{% else %}<span class="text-slate-400">No especificado</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Relación:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.emergency_contact_relationship %}{{ resident.get_emergency_contact_relationship_display }}{% else %}<span class="text-slate-400">No especificada</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Teléfono:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.emergency_contact_phone %}{{ resident.emergency_contact_phone }}{% else %}<span class="text-slate-400">No especificado</span>{% endif %}
                </span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Email:</span>
                <span class="text-sm font-semibold text-slate-800">
                    {% if resident.emergency_contact_email %}{{ resident.emergency_contact_email }}{% else %}<span class="text-slate-400">No especificado</span>{% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Información de Admisión -->
    <div class="content-card">
        <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
            <span class="material-icons mr-2">event</span>
            Información de Admisión
        </h3>
        <div class="space-y-4">
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Fecha de admisión:</span>
                <span class="text-sm font-semibold text-slate-800">{{ resident.admission_date|date:"d/m/Y" }}</span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Tiempo de estancia:</span>
                <span class="text-sm font-semibold text-slate-800">{{ resident.length_of_stay }} días</span>
            </div>
            
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium text-slate-600">Habitación:</span>
                <div class="text-right">
                    {% if resident.room %}
                    <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full bg-emerald-100 text-emerald-800">{{ resident.room.room_number }}</span>
                    <div class="text-xs text-slate-500 mt-1">Piso {{ resident.room.floor }}</div>
                    {% else %}
                    <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full bg-amber-100 text-amber-800">Sin asignar</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Información Adicional -->
{% if resident.notes %}
<div class="content-card mt-8">
    <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
        <span class="material-icons mr-2">description</span>
        Notas Adicionales
    </h3>
    <div class="bg-slate-50 rounded-lg p-4">
        <p class="text-sm text-slate-700 leading-relaxed">{{ resident.notes|linebreaks }}</p>
    </div>
</div>
{% endif %}

<!-- Informes Recientes -->
<div class="content-card mt-8">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-slate-700 flex items-center">
            <span class="material-icons mr-2">assessment</span>
            Informes Recientes
        </h3>
        <div class="flex space-x-2">
            <a href="{% url 'residents_web:resident_reports_list' resident.id %}" 
               class="btn-modern-secondary text-xs">
                <span class="material-icons text-sm mr-1">list</span>
                <span class="text-xs">Ver Todos</span>
            </a>
            <a href="{% url 'residents_web:resident_report_create' resident.id %}" 
               class="btn-modern text-xs">
                <span class="material-icons text-sm mr-1">add</span>
                <span class="text-xs">Nuevo Informe</span>
            </a>
        </div>
    </div>
    {% if recent_reports %}
        <div class="space-y-4">
            {% for report in recent_reports %}
            <div class="border border-slate-200 rounded-xl p-4 hover:bg-slate-50 transition-all duration-300">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-2">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium
                                {% if report.status == 'completed' %}bg-green-100 text-green-800
                                {% elif report.status == 'draft' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ report.get_status_display }}
                            </span>
                            <span class="text-xs text-slate-500">{{ report.get_report_type_display }}</span>
                        </div>
                        <h4 class="text-sm font-medium text-slate-900 mb-1">
                            Informe del {{ report.report_date|date:"d/m/Y" }}
                        </h4>
                        {% if report.recommendations %}
                            <p class="text-xs text-slate-600 line-clamp-2">{{ report.recommendations|truncatewords:15 }}</p>
                        {% endif %}
                    </div>
                    <div class="flex-shrink-0">
                        <a href="{% url 'residents_web:resident_report_detail' resident.id report.id %}" 
                           class="btn-modern-secondary text-xs">
                            <span class="material-icons text-sm mr-1">visibility</span>
                            <span class="text-xs">Ver</span>
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12">
            <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="material-icons text-slate-400 text-2xl">assessment</span>
            </div>
            <h3 class="text-lg font-medium text-slate-900 mb-2">No hay informes recientes</h3>
            <p class="text-slate-600 mb-6">Aún no se han creado informes para este residente.</p>
            <a href="{% url 'residents_web:resident_report_create' resident.id %}" 
               class="btn-modern">
                <span class="material-icons mr-2">add</span>
                Crear Primer Informe
            </a>
        </div>
    {% endif %}
</div>

<!-- Información de Auditoría -->
<div class="content-card mt-8">
    <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
        <span class="material-icons mr-2">info</span>
        Información de Auditoría
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="flex justify-between items-center p-4 bg-slate-50 rounded-lg">
            <span class="text-sm font-medium text-slate-600">Creado:</span>
            <span class="text-sm font-semibold text-slate-800">{{ resident.created_at|date:"d/m/Y H:i" }}</span>
        </div>
        
        <div class="flex justify-between items-center p-4 bg-slate-50 rounded-lg">
            <span class="text-sm font-medium text-slate-600">Última actualización:</span>
            <span class="text-sm font-semibold text-slate-800">{{ resident.updated_at|date:"d/m/Y H:i" }}</span>
        </div>
    </div>
</div>

{% endblock %} 
